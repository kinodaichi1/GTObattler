【現状の課題】

現在の分析ロジックは、「フォールド(EV=0)」「コール」「ポットの50%ベット」という固定された3つの選択肢しか評価していない。そのため、状況によっては全く適切でないアクションを推奨してしまう。

【新しい設計思想】

AIが複数の合理的なアクション候補を自ら生成し、それぞれの期待値（EV）を個別に計算・比較することで、真の最適手を見つけ出すアプローチに変更する。

この実現のため、分析プロセスを以下の4ステップに再構築します。

【Step 1】 Heroのハンドのカテゴリ分け

まず、AIはHeroが持つハンドが、現在のボードにおいてどのような性質を持つかを客観的に分類します。これにより、その後のアクションの「目的」が明確になります。

カテゴリ	説明	例（ボード: K♠ 8♦ 3♣）
プレミアムメイドハンド	セット（スリーカード）以上の非常に強力な完成役。相手から最大限のチップを引き出す（バリューを取る）ことが目的。	8♥8♣ (セット)
ストロングメイドハンド	トップペア・トップキッカー(TPTK)など、十分に強いが相手の逆転もあり得る役。基本的にはバリューベットが主体。	A♠K♥ (トップペア)
マージナルメイドハンド	ミドルペアやウィークペアなど、相手の攻撃には弱いが、チェックすれば勝てる可能性（ショーダウンバリュー）がある役。ポットを大きくしたくない。	9♠9♦, A♦8♠
強力なドローハンド	あと1枚で非常に強い役が完成する見込みのある手（フラッシュドロー、オープンエンドストレートドローなど）。セミブラフの候補になる。	A♠T♠ (フラッシュドロー)
ウィークドロー/エア	ガットショットドローや、全く役のないハンド。基本的にはフォールドだが、状況次第でブラフの候補になる。	T♥9♦, A♥Q♦
【Step 2】 アクション候補（手札）の生成

Step 1のハンドカテゴリに基づき、AIがその状況で検討すべき合理的なアクションのリスト（候補手）を動的に生成します。

もし相手からベットされている場合:

候補: フォールド, コール, レイズ (50% Pot), レイズ (100% Pot)

（例: プレミアムハンドならレイズ候補を、マージナルハンドならコール候補を、エアならフォールド候補を主に検討する）

もしチェックで回ってきた場合:

候補: チェック, ベット (33% Pot), ベット (66% Pot), ベット (100% Pot)

（例: プレミアム/ストロングハンドならベット候補を、マージナルハンドならチェック候補を、ドローハンドならベット(セミブラフ)候補とチェック候補の両方を検討する）

【Step 3】 各アクション候補の期待値（EV）を再計算

新しいcalculateEvOfBet関数は、ベットサイズに応じて相手の反応（コール率/フォールド率）が変化する、より現実に近いモデルを導入します。

新しいEV計算ロジックの概要:

引数: betSize（ベット額）を追加で受け取る。

相手のコール判断基準の計算: 相手がコールするために必要な勝率（ポットオッズ）を計算する。

必要勝率 = コール額 / (現在のポット + ベット額 + コール額)

相手のコールレンジを推定: 相手の推定レンジの中から、上記の必要勝率を上回るエクイティを持つハンドを「コールするレンジ」として絞り込む。

コール率/フォールド率の算出:

コール率 = (コールするレンジのハンド数 / 相手の全レンジのハンド数)

フォールド率 = 1 - コール率

最終的なEVの計算:

EV(ベット) = (ポット額 × フォールド率) + (コールされた時のポット総額 × エクイティ - ベット額) × コール率

このロジックにより、「小さいベットは広くコールされ、大きいベットは強いハンドにしかコールされない」という現実的な挙動をシミュレートできます。

【Step 4】 全候補を評価し、最適アクションを決定・提示

メインの分析関数 (calculateAllEVs) が、Step 2で生成されたすべてのアクション候補をループ処理し、それぞれのEVを計算します。

EV(フォールド) = 0

EV(チェック) = (ポット額 × エクイティ) ※将来的な相手のベットを考慮しない簡易版

EV(コール) = (ポット総額 × エクイティ) - コール額

EV(ベット 33%) = Step 3のロジックで計算

EV(ベット 66%) = Step 3のロジックで計算

EV(ベット 100%)= Step 3のロジックで計算

最後に、算出されたすべてのEVの中で最も高い数値を持つアクションを「最適アクション」として採用し、その根拠と、比較対象となった他のアクションのEVも合わせて結果画面に表示します。

【新しい出力結果のイメージ】
分析結果

最適アクション: ベット (990) (ポットの約66%)

アクションの根拠

あなたのハンド(8♥8♣)はプレミアムメイドハンドに分類されます。相手のレンジにはコールが期待できるトップペア（Kx）などが十分に存在するため、バリュー（価値）を引き出すためのベットが最適です。ポットの2/3程度のベットは、相手を降ろしすぎず、かつ十分にポットを大きくできるため、最も期待値が高いと判断しました。

各アクションの期待値(EV)

ベット (990): +1850 🏆

ベット (1500): +1680

ベット (495): +1450

チェック: +1350

この設計変更により、AIは単一のパターンを繰り返すのではなく、状況に応じてベットサイズを使い分ける、より高度で信頼性の高い分析パートナーへと進化します。