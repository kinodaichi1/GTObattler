# GTO Battler 要件定義書
**バージョン: 1.3.0**
**最終更新日: 2025/10/03**

---

### 1. プロジェクト概要

*   **名称:** **GTO Battler**
*   **目的:** テキサスホールデム中級者以上のプレイヤーが、学習や実践プレイを補助し、特定の状況における最適なアクションを分析・発見するために利用する多機能Webツールを開発する。
*   **ゴール:** 主要機能に加え、中核となる「アクション分析機能」を実装し、GitHub Pages上で公開されたPWA（プログレスウェブアプリ）として、PCやスマートフォンから快適に利用できる状態にする。

---

### 2. デザイン要件

*   **テーマ:** ダークテーマを基調とする。
*   **コンセプト:** 視認性が高く、長時間利用しても目が疲れにくい「見やすさ」と、シャープで洗練された「かっこよさ」を両立させ、ツール全体で統一感のあるデザインを目指す。
*   **ロゴ:** 作成済み。サイトのヘッダーおよび起動時のローディング画面に実装済み。

---

### 3. 機能要件

#### 【機能1】 レンジファインダー
*   **概要:** GTOに基づいたプリフロップのハンドレンジを表示する。
*   **仕様:**
    *   対応人数: 6人 (6-max), ヘッズアップ (HU)
    *   スタックサイズ: 100BB, 20BB
    *   表示アクション: オープンレンジ (全対応), 3ベットレンジ (HUのみ)

#### 【機能2】 トーナメントタイマー
*   **概要:** ホームゲームなどで利用するカスタマイズ可能なタイマー。
*   **仕様:**
    *   カウントダウン、スタート/ポーズ/リセット機能
    *   ブラインドレベル、時間、Anteの自由設定
    *   レベルアップ時のアラーム通知
    *   編集内容の保存機能

#### 【機能3】 オッズ計算機
*   **概要:** ポットオッズを素早く計算するシンプルなツール。
*   **仕様:** ポット額とコール額を入力すると、必要勝率をパーセンテージで表示する。

#### 【機能4】 ポーカー用語集
*   **概要:** ポーカーに関する用語を解説するリファレンス。
*   **仕様:**
    *   アコーディオン形式で用語と解説を表示。
    *   検索機能は不要。

#### 【機能5】 アクション分析
*   **概要:** ユーザーが入力した状況に基づき、AIが最適なアクションとその根拠を提示する中核機能。
*   **詳細ロジック:** 以下の5ステップで分析を行う。

    ##### Step 1: 状況の完全な把握（入力情報の解析）
    *   **ゲーム状況の特定:** アクション履歴から現在のストリートと正確なポットサイズを計算する。
    *   **プレイヤーの役割の定義:** アクション履歴を解析し、プリフロップ・アグレッサーを特定する。

    ##### Step 2: プレイヤーのハンドレンジを推定する
    *   **プリフロップ・レンジの初期設定:** ポジションやアクション（オープンレイズ、コール、3ベット）に基づき、事前に定義されたレンジを各プレイヤーに割り当てる。
    *   **フロップ以降のレンジの絞り込み:** コミュニティカードと、その後のアクション（ベット、チェック、コール等）を考慮して、各プレイヤーのハンドレンジを動的に絞り込む。

    ##### Step 3: 優位性の計算（エクイティとレンジアドバンテージ）
    *   **ハンドエクイティ（勝率）の計算:** 「Heroのハンド vs 相手の推定レンジ」の勝率をモンテカルロ法でシミュレーションする。
    *   **レンジアドバンテージの評価:** レンジ全体として、現在のボードでどちらが有利かを評価する。ナッツ（最強役）を作れるハンドの多さも考慮する。

    ##### Step 4: 各アクションの期待値（EV）を比較し、最適手を決定する
    *   **EV(フォールド):** 常に`0`。
    *   **EV(コール):** `(ポット総額 × エクイティ) - コール額`で計算。
    *   **EV(ベット/レイズ):** バリューベットとブラフベットの両方の可能性を考慮し、相手のコール/フォールド確率を推定して期待値を計算する。
    *   上記3つの期待値を比較し、最も高いアクションを選択する。

    ##### Step 5: 分析結果と根拠を分かりやすく提示する
    *   AIの思考プロセス（レンジ分析、エクイティ、各アクションの期待値など）を、ユーザーが理解できる自然な言葉で説明し、結果として提示する。

---

### 4. 開発ステータス

**プロジェクトの進捗：** **【新機能『アクション分析』開発中】**

*   既存の主要機能（レンジファインダー、タイマー、計算機、用語集）は実装完了。
*   現在、プロジェクトの中核となる**「アクション分析機能」**の実装に取り組んでいる段階。

---

### 5. ファイル構成（推奨）
📂 GTObattler/
├── 📄 GTO battler.md
├── 📄 README.md
├── 📄 index.html
├── 📄 script.js
├── 📄 style.css
├── 📄 コピー.py
├── 📄 テキサスホールデムの中身.html
├── 📄 改善すべきこと.txt
├── 📂 audio/
│   ├── 📄 Alarm.mp3
├── 📂 data/
│   ├── 📄 glossary.js
│   ├── 📄 questions.js
│   ├── 📄 ranges.js
├── 📂 image/
│   ├── 📄 GTO battler.png
│   ├── 📄 club.png
│   ├── 📄 diamond.png
│   ├── 📄 heart.png
│   ├── 📄 spade.png