# GTO Battler 要件定義書
**バージョン: 1.3.1**
**最終更新日: 2025/10/09**

---

### 1. プロジェクト概要

*   **名称:** **GTO Battler**
*   **目的:** テキサスホールデム中級者以上のプレイヤーが、学習や実践プレイを補助し、特定の状況における最適なアクションを分析・発見するために利用する多機能Webツールを開発する。
*   **ゴール:** 主要機能に加え、中核となる「アクション分析機能」を実装し、GitHub Pages上で公開されたPWA（プログレスウェブアプリ）として、PCやスマートフォンから快適に利用できる状態にする。

---

### 2. デザイン要件

*   **テーマ:** ダークテーマを基調とする。
*   **コンセプト:** 視認性が高く、長時間利用しても目が疲れにくい「見やすさ」と、シャープで洗練された「かっこよさ」を両立させ、ツール全体で統一感のあるデザインを目指す。
*   **ロゴ:** 作成済み。サイトのヘッダーおよび起動時のローディング画面に実装済み。

---

### 3. 機能要件 (実装完了済み)

#### 【機能1】 AIアクション分析
*   **概要:** ユーザーが入力した状況に基づき、AIが最適なアクションとその根拠を提示する中核機能。
*   **詳細ロジック:** 以下の5ステップで分析を行う。

    ##### Step 1: 状況の完全な把握（入力情報の解析）
    *   **ゲーム状況の特定:** アクション履歴から現在のストリートと正確なポットサイズを計算する。
    *   **プレイヤーの役割の定義:** アクション履歴を解析し、プリフロップ・アグレッサーを特定する。

    ##### Step 2: プレイヤーのハンドレンジを推定する
    *   **プリフロップ・レンジの初期設定:** ポジションやアクション（オープンレイズ、コール、3ベット）に基づき、事前に定義されたレンジを各プレイヤーに割り当てる。
    *   **フロップ以降のレンジの絞り込み:** コミュニティカードと、その後のアクション（ベット、チェック、コール等）を考慮して、各プレイヤーのハンドレンジを動的に絞り込む。

    ##### Step 3: 優位性の計算（エクイティとレンジアドバンテージ）
    *   **ハンドエクイティ（勝率）の計算:** 「Heroのハンド vs 相手の推定レンジ」の勝率をモンテカルロ法でシミュレーションする。
    *   **レンジアドバンテージの評価:** レンジ全体として、現在のボードでどちらが有利かを評価する。ナッツ（最強役）を作れるハンドの多さも考慮する。

    ##### Step 4: 各アクションの期待値（EV）を比較し、最適手を決定する
    *   **EV(フォールド):** 常に`0`。
    *   **EV(コール):** `(ポット総額 × エクイティ) - コール額`で計算。
    *   **EV(ベット/レイズ):** バリューベットとブラフベットの両方の可能性を考慮し、相手のコール/フォールド確率を推定して期待値を計算する。
    *   上記3つの期待値を比較し、最も高いアクションを選択する。

    ##### Step 5: 分析結果と根拠を分かりやすく提示する
    *   AIの思考プロセス（レンジ分析、エクイティ、各アクションの期待値など）を、ユーザーが理解できる自然な言葉で説明し、結果として提示する。

#### 【機能2】 レンジファインダー
*   **概要:** GTOに基づいたプリフロップのハンドレンジを表示する。
*   **仕様:**
    *   対応人数: 6人 (6-max), ヘッズアップ (HU)
    *   スタックサイズ: 100BB, 20BB
    *   表示アクション: オープンレンジ (全対応), 3ベットレンジ (HUのみ)

#### 【機能3】 トーナメントタイマー
*   **概要:** ホームゲームなどで利用するカスタマイズ可能なタイマー。
*   **仕様:**
    *   カウントダウン、スタート/ポーズ/リセット機能
    *   ブラインドレベル、時間、Anteの自由設定
    *   レベルアップ時のアラーム通知
    *   編集内容の保存機能

#### 【機能4】 GTOトレーナー
*   **概要:** 様々なシチュエーション問題に挑戦し、クイズ形式でGTO戦略の基礎を学習する機能。
*   **仕様:**
    *   問題カテゴリの選択機能 (用語、プリフロップ、シチュエーション判断)
    *   スコア表示機能

#### 【機能5】 テキサスホールデム
*   **概要:** 実際にプレイできるテキサスホールデムシミュレーター。
*   **仕様:**
    *   2〜10人でのプレイに対応。
    *   スタックやブラインドの初期設定が可能。
    *   基本的なアクション（フォールド、チェック、コール、ベット、レイズ）が可能。

#### 【機能6】 ポーカー用語集
*   **概要:** ポーカーに関する用語を解説するリファレンス。
*   **仕様:**
    *   カテゴリ別の表示。
    *   アコーディオン形式で用語と解説を表示。

---

### 4. 開発ステータス

**プロジェクトの進捗：** **【アクション分析の高度化 (Phase 1) 開発中】**

*   **実装完了:** AIアクション分析 (v1.3.0), レンジファインダー, トーナメントタイマー, GTOトレーナー, テキサスホールデム, ポーカー用語集。
*   **現在のタスク:** `v1.3.1`アップデートに向け、アクション分析機能の精度を向上させる以下の機能を開発中。
    *   **ICM (Independent Chip Model) の実装:** トーナメント終盤の分析精度を飛躍的に向上させ、$EVに基づいた最適アクションを推奨する。
    *   **レンジアドバンテージの評価:** ボードテクスチャを読み取り、「レンジ全体として有利か」を判断し、より戦略的なアクション提案に繋げる。
    -   **ブロッカー効果の考慮:** ヒーローのハンドが相手のナッツ級の組み合わせをどれだけブロックしているかを評価し、ブラフの成功率などをより正確に計算する。

---

### 5. ファイル構成（推奨）
📂 GTObattler/
├── 📄 GTO battler.md
├── 📄 README.md
├── 📄 index.html
├── 📄 script.js
├── 📄 style.css
├── 📄 アクション分析の新しい設計思想.txt
├── 📄 コピー.py
├── 📄 テキサスホールデムの中身.html
├── 📄 改善すべきこと.txt
├── 📂 Systeminstructions/
│   ├── 📄 GTO battler si.md
│   ├── 📄 総合的な.md
├── 📂 audio/
│   ├── 📄 Alarm.mp3
├── 📂 data/
│   ├── 📄 glossary.js
│   ├── 📄 questions.js
│   ├── 📄 ranges.js
├── 📂 image/
│   ├── 📄 GTO battler.png
│   ├── 📄 club.png
│   ├── 📄 diamond.png
│   ├── 📄 heart.png
│   ├── 📄 spade.png